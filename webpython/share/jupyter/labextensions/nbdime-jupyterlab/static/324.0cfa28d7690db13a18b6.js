"use strict";(self.webpackChunknbdime_jupyterlab=self.webpackChunknbdime_jupyterlab||[]).push([[324],{4324:(e,t,i)=>{i.r(t),i.d(t,{default:()=>gi});var n=i(7308),s=i(7807),r=i(7749),o=i(9499),l=i(9122),a=i(8190),d=i(9053),c=i(6697),h=i(7717),u=i(125),f=i(8778),m=i(7932);class p extends Error{constructor(e,t="error"){super(e),Object.setPrototypeOf(this,p.prototype),this.message=e,this.stack=(new Error).stack,this.severity=t}}function g(e,t){return t.indexOf(e)>=0}function y(e){return null!==e&&0!==e.length}function b(e){return e.match(/^.*(\r\n|\r|\n|$)/gm)}function _(e){if("object"!=typeof e){if(g(typeof e,["string","number","boolean"]))return e;throw new TypeError("Cannot deepcopy non-object")}if(null===e)return null;if(Array.isArray(e)){let t=e.length,i=new Array(t);for(let n=0;n<t;n++)i[n]=_(e[n]);return i}{let t=e,i={};void 0!==t.prototype&&(i.prototype=t.prototype);for(let n in e)i[n]=_(t[n]);return i}}function w(e){let t=Object.create(Object.getPrototypeOf(e));for(let i in e){let n=e[i];if(null!=n&&n.hasOwnProperty("constructor")&&n.constructor===Function)continue;let s=Object.getOwnPropertyDescriptor(e,i);s&&!s.get&&Object.defineProperty(t,i,s)}return t}function C(e,t){if(null===e||null===t)return null;if(e===t)return e.slice();let i=0;for(;i<Math.min(e.length,t.length)&&e[i]===t[i];++i);return e.slice(0,i)}function k(e,t){if(e===t)return!0;if(null===e||0===e.length)return!0;if(null===t||e.length>t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function v(e,t){return function(e,i){let n=[];for(let t=0;t<e.length;++t)n.push({index:t,key:e[t]});n=n.sort(((e,i)=>function(e,i){let n=e[t],s=i[t];return n<s?-1:n>s?1:0}(e.key,i.key)||e.index-i.index));let s=new Array(e.length);for(let t=0;t<e.length;++t)s[t]=e[n[t].index];return s}(e)}function E(e,t){if(t<1)return"";let i="",n=e.valueOf();for(;t>1;)1&t&&(i+=n),t>>=1,n+=n;return i+n}function x(e,t,i){return i.indexOf(e)===t}function S(e,t){let i=[];[e,t]=e.length>t.length?[e,t]:[t,e];for(let n of e)-1!==t.indexOf(n)&&i.push(n);return i}function T(e){return{op:"remove",key:e}}function D(e,t){return{op:"removerange",key:e,length:t}}function I(e,t){return{op:"patch",key:e,diff:t}}function O(e,t){if("number"!=typeof t.key)throw console.warn("Invalid patch details",e,t),new TypeError(`Invalid patch sequence op: Key is not a number: ${t.key}`);let i=t.key;if("addrange"===t.op){if(i<0||i>e.length||isNaN(i))throw new RangeError("Invalid add range diff op: Key out of range: "+i)}else if("removerange"===t.op){if(i<0||i>=e.length||isNaN(i))throw new RangeError("Invalid remove range diff op: Key out of range: "+i);if(i+t.length>e.length||isNaN(i))throw new RangeError("Invalid remove range diff op: Range too long!")}else{if("patch"!==t.op)throw new Error("Invalid op: "+t.op);if(i<0||i>=e.length||isNaN(i))throw new RangeError("Invalid patch diff op: Key out of range: "+i)}}function M(e,t,i){let n=t.op;if("string"!=typeof t.key)throw console.warn("Invalid patch details",e,t,i),new TypeError(`Invalid patch object op: Key is not a string: ${t.key}`);let s=t.key;if("add"===n){if(g(s,i))throw new Error("Invalid add key diff op: Key already present: "+s)}else if("remove"===n){if(!g(s,i))throw new Error("Invalid remove key diff op: Missing key: "+s)}else if("replace"===n){if(!g(s,i))throw new Error("Invalid replace key diff op: Missing key: "+s)}else{if("patch"!==n)throw new Error("Invalid op: "+n);if(!g(s,i))throw new Error("Invalid patch key diff op: Missing key: "+s)}}const W="  ";function F(e,t){if(!e)return null;for(let i=0;i<e.length;++i)if(e[i].key===t)return e[i].diff||null;return null}function j(e,t){if(!e)return null;for(let i=0;i<e.length;++i)if(e[i].key===t)return e[i];return null}function L(e,t,i){if(O(e,t),"patch"===t.op){let i=e[t.key],n=t.diff;if(null!==n)for(let e of n)O(i,e)}}var N=i(7930);class A{constructor(e,t,i){this.from=e,this.to=e+t,this.source=i}offset(e){this.from+=e,this.to+=e}}class P{constructor(e,t,i,n){this.from=e,this.to=t,this.chunkStartLine=!0===i,this.endsOnNewline=!0===n}}function R(e,t){if(0===e.length)return 0;let i=null;return e.some((function(e,n){return e>=t&&(i=n,!0)})),null===i?e.length:i}function V(e,t){return e.line(t.line+1).from+t.column}function B(e,t){let i=e.lineAt(t);return{line:i.number-1,column:t-i.from}}function H(e,t){let i=[],n=-1;for(;-1!==(n=t.indexOf("\n",n+1));)i.push(n);let s=[];for(let n of e){let e=R(i,n.from),r=e>0?i[e-1]+1:0,o={line:e,column:n.from-r};e=R(i,n.to-1),r=e>0?i[e-1]+1:0;let l={line:e,column:n.to-r},a=g(n.from,i),d=g(n.to-1,i),c=0===o.column&&(o.line!==l.line||d||n.to===t.length)||!a||!g(n.from-1,i)&&!g(n.to,i),h=new P(o,l,c,d);h.source=n.source,s.push(h)}return s}class G{constructor(e,t,i,n,s){this.baseFrom=e,this.baseTo=t,this.remoteFrom=i,this.remoteTo=n,this.sources=s?[s]:[]}inEdit(e){return e>=this.baseFrom&&e<=this.baseTo}inOrig(e){return e>=this.remoteFrom&&e<=this.remoteTo}}class z{constructor(){this._currentGhost=null,this.chunks=[],this.editOffset=0}_getCurrent(){return this._currentGhost?(this._currentGhost=null,null):this.chunks.length>0?this.chunks[this.chunks.length-1]:null}_overlapChunk(e,t,i){return i?e.inOrig(t.from.line):e.inEdit(t.from.line)}addDiff(e,t){let i=e.to.line-e.from.line;e.endsOnNewline&&(i+=1);const n=0===e.from.column&&i>0,s=e.chunkStartLine?0:1,r=e.chunkStartLine&&e.endsOnNewline&&n?0:1;let o=this._getCurrent();if(o&&(t?this._overlapChunk(o,e,t)?(o.remoteTo=Math.max(o.remoteTo,e.from.line+r+i),o.baseTo=Math.max(o.baseTo,e.from.line+r+this.editOffset),e.source&&!g(e.source,o.sources)&&o.sources.push(e.source)):o=null:this._overlapChunk(o,e,t)?(o.remoteTo=Math.max(o.remoteTo,e.from.line+r-this.editOffset),o.baseTo=Math.max(o.baseTo,e.from.line+r+i),e.source&&!g(e.source,o.sources)&&o.sources.push(e.source)):o=null),!o){if(t){let t=e.from.line,n=t+this.editOffset;o=new G(n+s,n+r,t+s,t+r+i)}else{let t=e.from.line,n=t-this.editOffset;o=new G(t+s,t+r+i,n+s,n+r)}e.source&&o.sources.push(e.source),this.chunks.push(o)}o.sources=o.sources.filter(x),this.editOffset+=t?-i:i}addGhost(e,t,i){let n=e.to.line-e.from.line;e.endsOnNewline&&(n+=1);let s=0===e.from.column&&n>0,r=e.chunkStartLine?0:1,o=e.chunkStartLine&&e.endsOnNewline&&s?0:1;t||(o+=n);let l=this._currentGhost,a=e.from.line+(t?i:0);if(l){let t=a-this.editOffset;l.baseTo>a?(l.remoteTo=Math.max(l.remoteTo,t+o),l.baseTo=Math.max(l.baseTo,a+o),e.source&&!g(e.source,l.sources)&&l.sources.push(e.source)):l=null}if(!l){let t=a-this.editOffset;l=new G(a+r,a+o,t+r,t+o),e.source&&l.sources.push(e.source),this.chunks.push(l)}this._currentGhost=l,l.sources=l.sources.filter(x)}}class U extends z{_overlapChunk(e,t,i){let n=t.from.line;return(e.baseFrom!==e.baseTo||e.remoteFrom>=e.remoteTo)&&(n+=1),i?e.inOrig(n):e.inEdit(n)}}function K(e){let t=null,i=[];for(let n of e)null===t?t=w(n):t.inEdit(n.baseFrom)?(t.remoteTo=Math.max(t.remoteTo,n.remoteTo),t.baseTo=Math.max(t.baseTo,n.baseTo),t.sources=t.sources.concat(n.sources)):(i.push(t),t=w(n)),t.sources=t.sources.filter(x);return null!==t&&i.push(t),i}class q{constructor(e,t){this._diffLUT={};let i=[];if(t)for(let e of t)i.push(e.key),this._diffLUT[e.key]=e;this._diffKeys=i,this.baseKeys=$(e)}keys(){this._remainingKeys=this.baseKeys.concat(this._diffKeys).filter(x).sort();const e=this;return{[Symbol.iterator]:()=>e}}isDiffKey(e){return g(e,this._diffKeys)}getDiffEntry(e){return this._diffLUT[e]}entriesAfterCurrentAddRem(){if(void 0===this._currentIsAddition)throw new Error("Current op is not an add or remove op");let e=this._currentIsAddition?"remove":"add";for(let t of this._remainingKeys){if(!g(t,this._diffKeys))return!0;if(this._diffLUT[t].op!==e)return!0}return!1}next(){let e=this._remainingKeys.shift();if(!e)return{done:!0,value:void 0};if(e&&g(e,this._diffKeys)){let t=this._diffLUT[e].op;this._currentIsAddition="add"===t||"remove"!==t&&void 0}return{value:e,done:!1}}}let $=Object.keys||function(e){let t=Object.prototype.hasOwnProperty||function(){return!0},i=[];for(let n in e)t.call(e,n)&&i.push(n);return i};var J=i(2117),Z=i.n(J);function Q(e,t,i=!0){let n=Z()(e,{space:W});return t&&(n=function(e,t,i){i=!1!==i;let n=e.split("\n"),s=new Array(n.length);i||(s[0]=n[0]);for(let e=i?0:1;e<n.length;e++)s[e]=E(W,t)+n[e];return s.join("\n")}(n,t,i)),n}function Y(e){return"string"==typeof e?e:null===e?"":Q(e)}function X(e,t,i){if(void 0===i&&(i=0),"string"==typeof e)return ee(e,t,i,i>0);if(Array.isArray(e))return function(e,t,i){let n="",s=[],r=[],o=0,l=",\n";if(null===t)return{remote:Q(e,i),additions:s,deletions:r};let a=0,d=0;for(let c of t){O(e,c);let t=c.key;for(;t>a;a++){let t=Q(e[a],i+1)+l;n+=t,o+=t.length}if("addrange"===c.op){let r="";for(let e of c.valuelist)r+=Q(e,i+1)+l;let o=r.length;t===e.length&&(o-=1),s.push(new A(n.length,o,c.source)),n+=r,d=0}else if("removerange"===c.op){let n="",s=c.length;for(let r=t;r<t+s;r++)n+=Q(e[r],i+1)+l;let a=n.length;s+t===e.length&&(a-=1),r.push(new A(o,a,c.source)),o+=n.length,d=c.length}else if("patch"===c.op){let a=X(e[t],c.diff,i+1);d=1;let h=a.remote+l;ie(n.length,a.additions,a.deletions),s=s.concat(a.additions),r=r.concat(a.deletions),o+=Q(e[t],i+1).length,n+=h}a=Math.max(a,t+d)}for(;e.length>a;a++)n+=Q(e[a],i+1)+l;n.slice(n.length-2)===l&&(n=n.slice(0,n.length-2));let c=E(W,i);return n=c+"[\n"+n+"\n"+c+"]",ie(c.length+2,s,r),{remote:n,additions:s,deletions:r}}(e,t,i);if("number"==typeof e||"boolean"==typeof e)throw new TypeError("Cannot patch an atomic type: "+typeof e);if(null===e)throw new TypeError("Cannot patch a null base!");return function(e,t,i){let n="",s=[],r=[],o=",\n",l=0;if(null===t)return{remote:Q(e,i),additions:s,deletions:r};let a=new q(e,t),d=a.baseKeys.slice();for(const t of a.keys()){let c=te(t,i+1);if(a.isDiffKey(t)){let h=a.getDiffEntry(t);if(M(e,h,d),g(h.op,["add","replace","remove"])){let u="replace"===h.op;if("add"===h.op||"replace"===h.op){let e=Q(h.value,i+1,!1)+o,t=n.length,r=e.length;u?t+=c.length:r+=c.length,!u&&a.entriesAfterCurrentAddRem()||(r-=2,"add"===h.op&&(r+=1)),s.push(new A(t,r,h.source)),n+=c+e}if("remove"===h.op||"replace"===h.op){let n=Q(e[t],i+1,!1)+o,s=l,f=n.length;u?s+=c.length:f+=c.length,!u&&a.entriesAfterCurrentAddRem()||(f-=2,"remove"===h.op&&(f+=1)),r.push(new A(s,f,h.source)),l+=c.length+n.length,d.splice(d.indexOf(t),1)}}else if("patch"===h.op){let a=X(e[t],h.diff,i+1),u=a.remote;u=c+u.slice((i+1)*W.length)+o,ie(n.length+c.length-(i+1)*W.length,a.additions,a.deletions),n+=u,s=s.concat(a.additions),r=r.concat(a.deletions),l+=Q(e[t],i+1,!1).length+c.length+2,d.splice(d.indexOf(t),1)}}else{let s=c+Q(e[t],i+1,!1)+o;n+=s,l+=s.length}}n.slice(n.length-2)===o&&(n=n.slice(0,n.length-2));let c=E(W,i);return n=c+"{\n"+n+"\n"+c+"}",ie(c.length+2,s,r),{remote:n,additions:s,deletions:r}}(e,t,i)}function ee(e,t,i,n){let s=[],r=[],o=0;if(null===t)return{remote:n?Q(e,i):e,additions:s,deletions:r};t=function(e,t){"string"==typeof e&&(e=b(e));let i=[0].concat(function(e){let t=[];return e.reduce((function(e,i,n){return t[n]=e+i.length}),0),t}(e)),n=[];for(let s of t){L(e,s);let t=i[s.key];if("patch"===s.op){let e=s.diff;if(null!==e)for(let i of e){let e=w(i);e.key+=t,n.push(e)}}else{let e=null;e="addrange"===s.op?{op:"addrange",key:t,valuelist:s.valuelist.join("")}:D(t,i[s.key+s.length]-t),e.source=s.source,n.push(e)}}return v(n,"key")}(e,t);let l=0,a=0,d="";for(let i of t){let t=i.key,n=e.slice(l,t);if(d+=n,o+=n.length,"addrange"===i.op){let e=i.valuelist;s.push(new A(d.length,e.length,i.source)),d+=e,a=0}else"removerange"===i.op&&(a=i.length,r.push(new A(o,a,i.source)),o+=a);l=Math.max(l,t+a)}return d+=e.slice(l,e.length),n&&(d=Q(d,i),ie(i*W.length+1,s,r),ne(d,s),ne(Q(e,i),r)),{remote:d,additions:s,deletions:r}}function te(e,t){return E(W,t)+'"'+e+'": '}function ie(e,t,i){for(let i of t)i.offset(e);for(let t of i)t.offset(e)}function ne(e,t){let i,n=['\\"',"\\\\","\\/","\\b","\\f","\\n","\\r","\\t"],s=/\\uD[89A-Fa-f][0-9a-fA-F]{2}\\uD[c-fC-F][0-9a-fA-F]{2}/g,r=/(?!\\uD[c-fC-F][0-9a-fA-F]{2})\\u(?!D[89A-Fa-f][0-9a-fA-F]{2})\d{4}/g,o=[],l=[];for(let t of n){let i=JSON.parse('"'+t+'"').length,n=0;for(;n=e.indexOf(t,n),!(n<0);)o.push(n),l.push(2-i),n++}for(;null!==(i=r.exec(e));)o.push(i.index),l.push(6-JSON.parse('"'+i[0]+'"').length);for(;null!==(i=s.exec(e));)o.push(i.index),l.push(12-JSON.parse('"'+i[0]+'"').length);for(let e=0;e<o.length;e++)for(let i of t){let t=o[e],n=l[e];i.from>t&&(i.from+=n),i.to>t&&(i.to+=n)}}function se(e,t){if("string"==typeof e)return ee(e,t,0,!1).remote;if(Array.isArray(e))return function(e,t){if(null===t)return _(e);let i=[],n=0,s=0;for(let r of t){O(e,r);let t=r.key;for(let s of e.slice(n,t))i.push(_(s));"addrange"===r.op?(i=i.concat(r.valuelist),s=0):"removerange"===r.op?s=r.length:"patch"===r.op&&(i.push(se(e[t],r.diff)),s=1),n=Math.max(n,t+s)}for(let t of e.slice(n))i.push(_(t));return i}(N.JSONExt.deepCopy(e),t);if("number"==typeof e||"boolean"==typeof e)throw new TypeError("Cannot patch an atomic type: "+typeof e);if(null===e)throw new TypeError("Cannot patch a null base!");return function(e,t){let i={},n=Object.keys(e);if(t)for(let s of t){M(e,s,n);let t=s.key;"add"===s.op?i[t]=s.value:"remove"===s.op?n.splice(n.indexOf(t),1):"replace"===s.op?(n.splice(n.indexOf(t),1),i[t]=s.value):"patch"===s.op&&(n.splice(n.indexOf(t),1),i[t]=se(e[t],s.diff))}for(let t of n)i[t]=_(e[t]);return i}(N.JSONExt.deepCopy(e),t)}function re(e,t){for(let i of t.reverse())e=[I(i,e)];return e}function oe(e,t){for(let i of t)e=e[i];return e}function le(e,t){return e&&t?e.concat(t):e?e.slice():t?t.slice():[]}function ae(e,t){let i=t.action;if("base"===i)return[];if("local"===i||"either"===i)return t.localDiff?t.localDiff.slice():[];if("remote"===i)return t.remoteDiff?t.remoteDiff.slice():[];if("custom"===i)return t.customDiff?t.customDiff.slice():[];if("local_then_remote"===i)return le(t.localDiff,t.remoteDiff);if("remote_then_local"===i)return le(t.remoteDiff,t.localDiff);if("clear"===i){let i=null;if("object"!=typeof e)throw new TypeError("Can only use `'clear'` action on objects/dicts");for(let e of le(t.localDiff,t.remoteDiff))if(i){if(i!==e.key)throw new Error("Cannot combine diffs with different keys")}else i=e.key;if(i){let s=function(e,t){return{op:"replace",key:e,value:t}}(i,(n=e[i])instanceof Array?[]:"string"==typeof n?"":null===n||g(typeof n,["number","boolean"])?null:{});return s.source={decision:t,action:"custom"},[s]}return[]}if("clear_parent"===i){if(Array.isArray(e)){let i=D(0,e.length);return i.source={decision:t,action:"custom"},[i]}if("string"==typeof e){let i=D(0,b(e).length);return i.source={decision:t,action:"custom"},[i]}{let i=[];for(let n of e){let e=T(n);e.source={decision:t,action:"custom"},i.push(e)}return i}}throw new Error('The action "'+i+'" is not defined');var n}function de(e,t){for(let i=0;i<t.length;++i){if("string"==typeof e)return[t.slice(0,i),t.slice(i)];e=e[t[i]]}return[t,null]}function ce(e,t){let i=[],n=null;for(let s=0;s<t.length;++s){let r,o=e[t[s]].path,l=e[t[s]].diff;if(i=i.concat(l),r=s===t.length-1?n:e[t[s+1]].path,!k(r,o)){let n=ce(e,t.slice(s+1));r=e[t[t.length-1]].path;let l=C(o,r),a=l?l.length:0;i=re(i,o.slice(a)).concat(re(n,r.slice(a)));break}null!==r&&(i=re(i,o.slice(r.length)),n=r)}return i}function he(e,t,i){let n={},s=[],r="local"===i,o="merged"===i;r||o||console.assert("remote"===i);for(let i of t){let t=null,l=de(e,i.localPath),a=l[0],d=l[1];if(o)t=ae(oe(e,a),i);else if(t=r?i.localDiff:i.remoteDiff,null===t)continue;let c="/"+a.join("/");if(n.hasOwnProperty(c))if(d){let e=F(n[c].diff,d[0]);e?e.push.apply(e,t):(t=re(t,d),n[c].diff.push(t[0]))}else n[c].diff=n[c].diff.concat(t);else d&&(t=re(t,d)),n[c]={diff:t,path:a},s.push(c)}return 0===Object.keys(n).length?null:(n.hasOwnProperty("/")||(n["/"]={diff:[],path:[]},s.push("/")),ce(n,s))}class ue{constructor(e,t,i,n,s,r,o){this.base=e,this._remote=t,null===e?(console.assert(0===n.length),this.deletions=[]):this.deletions=H(n,e),null===t?(console.assert(0===i.length),this.additions=[]):this.additions=H(i,t),this.collapsible=!0===s,this.collapsible&&(this.collapsibleHeader=r||"",this.startCollapsed=!0===o)}iterateDiffs(){return new ue.DiffIter(this)}getLineChunks(){let e=new U,t=this.iterateDiffs();for(let i=t.next();void 0!==i;i=t.next())e.addDiff(i.range,i.isAddition);return e.chunks}get remote(){return this._remote}set remote(e){this._remote=e}get unchanged(){return this.base===this.remote}get added(){return null===this.base}get deleted(){return null===this.remote}get additions(){return this._additions}set additions(e){this._additions=e}get deletions(){return this._deletions}set deletions(e){this._deletions=e}}function fe(e,t){console.assert(!!t,"Patch model needs diff.");const i=N.JSONExt.deepCopy(e);let n=Y(i),s=X(i,t);return new ue(n,s.remote,s.additions,s.deletions)}function me(e,t){let i=Y(e),n=Y(t),s=[],r=[];if(null===e&&null===t)throw new Error("Invalid arguments to createDirectStringDiffModel(). Both base and remote cannot be equal!");if(null===e)i=null,s.push(new A(0,n.length,void 0));else if(null===t)n=null,r.push(new A(0,i.length,void 0));else if(n!==i)throw new Error("Invalid arguments to createDirectStringDiffModel(). Either base or remote should be null, or they should be equal!");return new ue(i,n,s,r)}function pe(e,t,i){"code"===t.cell_type?e.mimetype=i:"markdown"===t.cell_type?e.mimetype="text/markdown":m.isRaw(t)&&(e.mimetype=t.metadata.format||"text/plain")}!function(e){e.DiffIter=class{constructor(e){this.editOffset=0,this.done=!1,this.ia=0,this.id=0,this.hintTakeDeletion=!1,this.model=e}next(){let e=null,t=null,i=this.model.additions,n=this.model.deletions,s=this.hintTakeDeletion;if(this.hintTakeDeletion=!1,this.ia<this.model.additions.length)if(this.id<n.length){let t=i[this.ia],r=n[this.id];t.from.line===r.from.line-this.editOffset&&t.from.column===r.from.column?s?e=!1:(this.hintTakeDeletion=!0,e=!0):e=t.from.line<r.from.line-this.editOffset||t.from.line===r.from.line-this.editOffset&&t.from.column<r.from.column}else e=!0;else{if(!(this.id<n.length))return void(this.done=!0);e=!1}t=e?i[this.ia++]:n[this.id++];let r=t.to.line-t.from.line;return t.endsOnNewline&&(r+=1),this.editOffset+=e?-r:r,{range:t,isAddition:e}}};class t{static cmp(e,t,i,n){if(void 0===e&&void 0===t)return 0;if(void 0===e)return 1;if(void 0===t)return-1;let s=e.range.from.line+(e.isAddition?i:0),r=t.range.from.line+(t.isAddition?n:0);return s<r||e.range.from.column<t.range.from.column?-1:s>r||e.range.from.column>t.range.from.column?1:0}constructor(e){this.currentOffset=0,this.models=[],this.iterators=[],this.values=[],this.offsets=[];for(let t of e){if(null===t)continue;this.models.push(t);let e=t.iterateDiffs();this.iterators.push(e),this.offsets.push(0),this.values.push(e.next())}}next(){let e=0;for(let i=1;i<this.values.length;++i)0>t.cmp(this.values[i],this.values[e],this.iterators[i].editOffset,this.iterators[e].editOffset)&&(e=i);this.i=e;let i=this.values[e];return this.currentOffset=this.offsets[e],this.offsets[e]=this.iterators[e].editOffset,void 0!==i&&(this.values[e]=this.iterators[e].next()),i}currentModel(){return this.models[this.i]}}e.SyncedDiffIter=t}(ue||(ue={}));var ge=i(4901);class ye{constructor(e,t,i){if(this.trustedChanged=new ge.Signal(this),!t&&!e)throw new Error("Either remote or base value need to be given");this.base=e,this.remote=!t&&i?se(e,i):t,this.diff=i||null,this.collapsible=!1}get unchanged(){return JSON.stringify(this.base)===JSON.stringify(this.remote)}get added(){return null===this.base}get deleted(){return null===this.remote}stringify(e){let t=function(e,i,n){if(!e)return e;if(Array.isArray(i)){const s=i.length>2?i.slice(1):i[1];return t(n?n(e,i[0]):e[i[0]],s,n)}return n?n(e,i):e[i]};const i=N.JSONExt.deepCopy(this.base);let n=e?t(i,e):i;const s=N.JSONExt.deepCopy(this.remote);let r=e?t(s,e):s,o=this.diff&&e?t(this.diff,e,F):this.diff,l=null;return l=this.unchanged||this.added||this.deleted||!o?me(n,r):fe(n,o),l.mimetype=e?this.innerMimeType(e):"application/json",l.collapsible=this.collapsible,l.collapsibleHeader=this.collapsibleHeader,l.startCollapsed=this.startCollapsed,l}get trusted(){return this._trusted}set trusted(e){this._trusted!==e&&(this._trusted=e,this.trustedChanged.emit(e))}get contents(){let e=[];return this.base&&e.push(this.base),this.remote&&this.remote!==this.base&&e.push(this.remote),e}}const be=["text/plain","application/vnd.jupyter.stdout","application/vnd.jupyter.stderr"];class _e extends ye{hasMimeType(e){let t=this.base||this.remote;return m.isStream(t)&&-1!==be.indexOf(e)?"text":m.isError(t)?"traceback":(m.isExecuteResult(t)||m.isDisplayData(t))&&e in t.data?["data",e]:null}innerMimeType(e){let t=(this.base||this.remote).output_type;if("stream"===t&&"text"===e||"error"===t&&"traceback"===e)return"text/plain";if(("execute_result"===t||"display_data"===t)&&Array.isArray(e))return e[1];throw new p("Unknown MIME type for key: "+e)}stringify(e){let t=super.stringify(e);return e&&(t.mimetype=this.innerMimeType(e)),t}}function we(e,t,i){let n=[];if(null!==t||i)if(null===e){if(null===t)throw new Error("Either base or remote need to be specififed!");for(let e of t)n.push(new _e(null,e))}else if(t===e)for(let t of e)n.push(new _e(t,t));else{if(!i)throw new Error("Invalid arguments to makeOutputModels()");{let t=0,s=0;for(let r of i){let i=r.key;for(let s of e.slice(t,i))n.push(new _e(s,s));if("addrange"===r.op){for(let e of r.valuelist)n.push(new _e(null,e));s=0}else if("removerange"===r.op){let t=r.length;for(let s=i;s<i+t;s++)n.push(new _e(e[s],null));s=t}else{if("patch"!==r.op)throw new Error("Invalid diff operation: "+r);n.push(new _e(e[i],null,r.diff)),s=1}t=Math.max(t,i+s)}for(let i of e.slice(t))n.push(new _e(i,i))}}else{if(null===e)throw new Error("Either base or remote need to be specififed!");for(let t of e)n.push(new _e(t,null))}return n}class Ce{constructor(e,t,i,n,s){this.base=e,this.remote=t,this.collapsible=!0===i,this.collapsible&&(this.collapsibleHeader=n||"",this.startCollapsed=!0===s)}get unchanged(){return this.base===this.remote}get added(){return void 0===this.base}get deleted(){return void 0===this.remote}}function ke(e,t,i){if(i){if("add"===i.op){if(void 0!==e)throw new Error("Invalid diff op on immutable value");return new Ce(e,i.value)}if("remove"===i.op){if(void 0===e)throw new Error("Invalid diff op on immutable value");return new Ce(e,void 0)}if(void 0===e)throw new Error("Invalid diff op on immutable value");return new Ce(e,i.value)}return new Ce(e,t)}class ve{constructor(e,t,i,n,s,r){if(this.source=e,this.metadata=t,this.outputs=i,this.executionCount=n,this.cellType=s,this.cellId=r,null===i&&"code"===s)throw new p("Invalid code cell, missing outputs!");this.metadata.collapsible=!0,this.metadata.collapsibleHeader="Metadata changed",this.metadata.startCollapsed=!0}get unchanged(){let e=this.source.unchanged;if(e=e&&(!this.metadata||this.metadata.unchanged),this.outputs)for(let t of this.outputs)e=e&&t.unchanged;return this.executionCount&&(e=e&&this.executionCount.unchanged),e}get added(){return this.source.added}get deleted(){return this.source.deleted}getChunkedOutputs(){if(null===this.outputs)return null;const e=[];if(this.added||this.deleted)for(let t of this.outputs)e.push([t]);else{let t=[];for(let i of this.outputs)i.added||i.deleted?t.push(i):(t.length&&e.push(t),e.push([i]),t=[]);t.length&&e.push(t)}return e}}function Ee(e,t,i){let n=null,s=null,r=null,o=null,l=F(t,"source");if(n=l?fe(e.source,l):me(e.source,e.source),pe(n,e,i),l=F(t,"metadata"),s=l?fe(e.metadata,l):me(e.metadata,e.metadata),m.isCode(e)){let i=e.outputs,n=F(t,"outputs");r=n?we(i,null,n):we(i,i);let s=e.execution_count;o=ke(s,s,j(t,"execution_count"))}let a=e.id;const d=ke(a,a,j(t,"id"));return new ve(n,s,r,o,e.cell_type,d)}function xe(e,t){let i=me(e.source,e.source);pe(i,e,t);let n=me(e.metadata,e.metadata),s=null,r=null;if(m.isCode(e)){s=we(e.outputs,e.outputs);let t=e.execution_count;r=ke(t,t)}let o=e.id;const l=ke(o,o);return new ve(i,n,s,r,e.cell_type,l)}function Se(e,t){let i=me(null,e.source);pe(i,e,t);let n=me(null,e.metadata),s=null,r=null;m.isCode(e)&&(s=we(null,e.outputs),r=ke(null,e.execution_count));const o=ke(null,e.id);return new ve(i,n,s,r,e.cell_type,o)}function Te(e,t){let i=me(e.source,null);pe(i,e,t);let n=me(e.metadata,null),s=null,r=null;m.isCode(e)&&(s=we(e.outputs,null),r=ke(e.execution_count,null));const o=ke(e.id,null);return new ve(i,n,s,r,e.cell_type,o)}class De{constructor(e,t){let i,n=F(t,"metadata");e.metadata&&n?this.metadata=fe(e.metadata,n):this.metadata=null,this.metadata&&(this.metadata.collapsible=!0,this.metadata.collapsibleHeader="Notebook metadata changed",this.metadata.startCollapsed=!0);try{i=e.metadata.language_info.mimetype}catch(e){}this.mimetype=i||"text/python",this.cells=[],this.chunkedCells=[];let s=0,r=0,o=-1,l=[];for(let i of F(t,"cells")||[]){let t=i.key;for(let i=s;i<t;i++){let t=xe(e.cells[i],this.mimetype);this.cells.push(t),this.chunkedCells.push([t])}if(t!==o&&(l=[],this.chunkedCells.push(l),o=t),"addrange"===i.op){for(let e of i.valuelist){let t=Se(e,this.mimetype);this.cells.push(t),l.push(t)}r=0}else if("removerange"===i.op){r=i.length;for(let i=t;i<t+r;i++){let t=Te(e.cells[i],this.mimetype);this.cells.push(t),l.push(t)}}else if("patch"===i.op){l.length>0&&(l=[],this.chunkedCells.push(l));let n=Ee(e.cells[t],i.diff,this.mimetype);this.cells.push(n),l.push(n),r=1}s=Math.max(s,t+r)}for(let t=s;t<e.cells.length;t++){let i=xe(e.cells[t],this.mimetype);this.cells.push(i),this.chunkedCells.push([i])}}}class Ie extends f.Panel{constructor({model:e,editorFactory:t,translator:i,...n}){super(),this._editorFactory=t,this._model=e,this._translator=i??d.nullTranslator,this._viewOptions=n}}const Oe="jp-CollapsiblePanel-header-icon",Me="jp-CollapsiblePanel-header-icon-opened",We="jp-CollapsiblePanel-header-icon-closed",Fe="jp-CollapsiblePanel-opened",je="jp-CollapsiblePanel-closed";class Le extends f.Panel{static createHeader(e){let t=new f.Panel;t.addClass("jp-CollapsiblePanel-header"),e&&(t.node.textContent=e);let i=document.createElement("button");return i.className=Oe,t.node.appendChild(i),t}constructor(e,t,i){super(),this.addClass("jp-CollapsiblePanel"),this.inner=e;let n=Le.createHeader(t);this.header=n,this.button=n.node.getElementsByClassName(Oe)[0],n.node.onclick=this.toggleCollapsed.bind(this),this.addWidget(n),this.container=new f.Panel,this.container.addClass("jp-CollapsiblePanel-container"),this.slider=new f.Panel,this.slider.addClass("jp-CollapsiblePanel-slider"),this.slider.addWidget(e),this.container.addWidget(this.slider),this.addWidget(this.container),this.slider.addClass(!0===i?je:Fe),this.button.classList.add(!0===i?We:Me),this.button.classList.add("fa"),this.button.classList.add(!0===i?"fa-caret-down":"fa-caret-up")}toggleCollapsed(){let e=this.slider,t=this.button;this.collapsed?(e.removeClass(je),e.addClass(Fe),t.classList.remove(We),t.classList.add(Me),this.button.classList.remove("fa-caret-down"),this.button.classList.add("fa-caret-up")):(e.removeClass(Fe),e.addClass(je),t.classList.remove(Me),t.classList.add(We),this.button.classList.remove("fa-caret-up"),this.button.classList.add("fa-caret-down"))}get collapsed(){return this.slider.hasClass(je)}set headerTitle(e){this.header.node.innerText=e}}var Ne=i(8204),Ae=i(6211);class Pe extends ue{constructor(e,t,i,n,s,r){super(Y(e),"",[],[],n,s,r),this.rawBase=e,this.decisions=t,this._outdated=!0,this._sourceModels=i,this._update()}get additions(){return this._outdated&&this._update(),this._additions}set additions(e){this._additions=e}get deletions(){return this._outdated&&this._update(),this._deletions}set deletions(e){this._deletions=e}get remote(){return this._outdated&&this._update(),this._remote}set remote(e){this._remote=e}invalidate(){this._outdated=!0}get invalid(){return this._outdated}getLineChunks(){let e=[this];e=e.concat(this._sourceModels);let t=new U,i=new ue.SyncedDiffIter(e);for(let e=i.next();void 0!==e;e=i.next())if(i.currentModel()===this)t.addDiff(e.range,e.isAddition);else{if(!e.range.source||"base"!==e.range.source.decision.action)continue;t.addGhost(e.range,e.isAddition,i.currentOffset)}return t.chunks}_update(){this._outdated=!1;let e=he(this.rawBase,this.decisions,"merged"),t=X(this.rawBase,e);this._additions=H(t.additions,t.remote),this._deletions=H(t.deletions,this.base||""),this._remote=t.remote}}var Re,Ve,Be=i(1373),He=i(8093),Ge=i(7454);class ze extends s.CodeEditorWrapper{constructor(e){const{factory:t,value:i,...n}=e,r=new He.YFile;i&&(r.source=i),super({model:new s.CodeEditor.Model({sharedModel:r}),factory:t??$e(),editorOptions:n}),this.staticLoaded=!1}get cm(){return this.editor.editor}get doc(){return this.editor.doc}}function Ue(e){const t=new Ge.EditorExtensionRegistry,i=["lineNumbers","readOnly","theme","allowMultipleSelections","tabSize"];for(const n of Ge.EditorExtensionRegistry.getDefaultExtensions({themes:e}))for(const e of i)n.name===e&&t.addExtension(n);return t.addExtension({name:"shared-model-binding",factory:e=>{const t=e.model.sharedModel;return Ge.EditorExtensionRegistry.createImmutableExtension((0,Ge.ybinding)({ytext:t.ysource,undoManager:t.undoManager??void 0}))}}),t}function Ke(){const e=new Ge.EditorLanguageRegistry;for(const t of Ge.EditorLanguageRegistry.getDefaultLanguages())e.addLanguage(t);return e.addLanguage({name:"ipythongfm",mime:"text/x-ipythongfm",load:async()=>{const[t,n]=await Promise.all([Promise.all([i.e(204),i.e(798)]).then(i.bind(i,2204)),i.e(513).then(i.bind(i,5513))]);return t.markdown({base:t.markdownLanguage,codeLanguages:t=>e.findBest(t),extensions:[(0,Ge.parseMathIPython)(Be.StreamLanguage.define(n.stexMath).parser)]})}}),e}function qe(){const e=new Ge.EditorThemeRegistry;for(const t of Ge.EditorThemeRegistry.getDefaultThemes())e.addTheme(t);return e}function $e(e={}){const t=new Ge.CodeMirrorEditorFactory({extensions:e.extensions??Ue(qe()),languages:e.languages??Ke(),translator:e.translator??d.nullTranslator});return t.newInlineEditor.bind(t)}!function(e){e[e.DIFF_DELETE=-1]="DIFF_DELETE",e[e.DIFF_INSERT=1]="DIFF_INSERT",e[e.DIFF_EQUAL=0]="DIFF_EQUAL"}(Re||(Re={})),function(e){e[e.INCOMING=0]="INCOMING",e[e.OUTGOING=1]="OUTGOING"}(Ve||(Ve={}));const Je="jp-Merge-gutter-picker",Ze="jp-Merge-gutter-conflict",Qe=Ae.Decoration.line({class:"jp-Merge-conflict"}),Ye=["chunk","conflict","start","end"];var Xe;!function(e){e.buildEditorDecorationDict=function(e,t){const i=t?"-"+t:"",n="cm-merge-"+e;return{chunk:Ae.Decoration.line({class:n+"-chunk"+i}),start:Ae.Decoration.line({class:n+"-chunk-start"+i}),end:Ae.Decoration.line({class:n+"-chunk-end"+i}),endEmpty:Ae.Decoration.line({class:n+"-chunk-end"+i+"-empty"}),conflict:Qe,inserted:Ae.Decoration.mark({class:n+"-inserted"}),deleted:Ae.Decoration.mark({class:n+"-deleted"})}}}(Xe||(Xe={}));const et={left:Xe.buildEditorDecorationDict("l"),right:Xe.buildEditorDecorationDict("r"),localMerge:Xe.buildEditorDecorationDict("m","local"),remoteMerge:Xe.buildEditorDecorationDict("m","remote"),customMerge:Xe.buildEditorDecorationDict("m","custom"),eitherMerge:Xe.buildEditorDecorationDict("m","either"),mixedMerge:Xe.buildEditorDecorationDict("m","mixed")},tt=Ae.EditorView.baseTheme({".cm-collapsedLines":{cursor:"pointer",color:"var(--jp-ui-font-color1)",backgroundColor:"var(--jp-layout-color2)",border:"var(--jp-border-width) solid var(--jp-border-color1)",fontSize:"90%",padding:"0 3px",borderRadius:"4px"}});function it(e=!0){const t=[tt,ot,at];return e?[...t,ft,wt,Ct]:t}function nt({from:e,to:t},i){return{from:i.mapPos(e),to:i.mapPos(t)}}const st=Ne.StateEffect.define({map:nt}),rt=Ne.StateEffect.define({map:nt}),ot=Ne.StateField.define({create:()=>Ae.Decoration.none,update(e,t){e=e.map(t.changes);for(let i of t.effects){let t;i.is(st)&&(t=et[i.value.decorationKey][i.value.highlightType],e=e.update({add:[t.range(i.value.from,i.value.to)]})),i.is(rt)&&(t=et[i.value.decorationKey][i.value.highlightType],e=e.update({filter:(e,i,n)=>t.spec.class!==n.spec.class}))}return e},provide:e=>Ae.EditorView.decorations.from(e)}),lt=Ne.StateEffect.define({map:(e,t)=>e.map(t)}),at=Ne.StateField.define({create:()=>Ae.Decoration.none,update:(e,t)=>{for(let e of t.effects)if(e.is(lt))return e.value;return e.map(t.changes)},provide:e=>Ae.EditorView.decorations.from(e)});class dt extends Ae.WidgetType{constructor(e){super(),this.size=e}toDOM(){let e=document.createElement("div");return e.className="cm-merge-spacer",e.style.height=this.size+"px",e.style.minWidth="1px",e}}const ct=Ne.StateEffect.define({map:(e,t)=>({from:t.mapPos(e.from),block:e.block,on:e.on,type:e.type})}),ht=Ne.StateEffect.define({map:e=>({type:e.type})});class ut extends Ae.GutterMarker{constructor(e){super(),this.symbol=e.symbol,this.className=e.className,this.block=e.block}toDOM(){let e=Mt("div",this.symbol);return e.className=this.className,e}eq(e){return e===this}}const ft=Ne.StateField.define({create:()=>Ne.RangeSet.empty,update:(e,t)=>{e=e.map(t.changes);for(let i of t.effects){if(i.is(ct)&&i.value.on){const t="picker"===i.value.type?i.value.block?pt:mt:i.value.block?yt:gt;let n=!1;e.between(i.value.from,i.value.from,((e,s,r)=>{if(e===i.value.from&&r.eq(t))return n=!0,!1})),n||(e=e.update({add:[t.range(i.value.from)]}))}i.is(ht)&&(e=Ne.RangeSet.empty)}return e}}),mt=new ut({symbol:"➭︎",className:Je,block:!1}),pt=new ut({symbol:"➭︎",className:Je,block:!0}),gt=new ut({symbol:"⚠︎",className:Ze,block:!1}),yt=new ut({symbol:"⚠︎",className:Ze,block:!0}),bt=Ne.StateEffect.define({map:(e,t)=>({line:t.mapPos(e.line),chunk:e.chunk,type:e.type})}),_t=Ne.StateEffect.define({map:e=>({type:e.type})}),wt=Ne.StateField.define({create:()=>new Map,update:(e,t)=>{let i=e;for(let e of t.effects)e.is(bt)&&"picker"===e.value.type&&i.set(e.value.line,e.value.chunk);return i}}),Ct=Ne.StateField.define({create:()=>new Map,update:(e,t)=>{let i=e;for(let e of t.effects)e.is(bt)&&"conflict"===e.value.type&&i.set(e.value.line,e.value.chunk);return i}}),kt=Ne.StateEffect.define({map:(e,t)=>t.mapPos(e)}),vt=Ne.StateEffect.define({map:(e,t)=>e.map(t)});class Et extends Ae.WidgetType{constructor(e,t){super(),this.lines=e,this.siblings=t}eq(e){return this.lines==e.lines&&this.siblings.every((t=>e.siblings.findIndex((e=>e.line==t.line&&e.cm==t.cm))>=0))}toDOM(e){let t=document.createElement("div");return t.className="cm-collapsedLines",t.textContent=e.state.phrase("(…$ unchanged lines…)",this.lines),t.addEventListener("click",(t=>{const i=e.posAtDOM(t.target);this.siblings.forEach((t=>{if(t.cm===e)e.dispatch({effects:kt.of(i)});else{const e=t.cm.state.doc.line(t.line).from;t.cm.dispatch({effects:kt.of(e)})}}))})),t}ignoreEvent(e){return e instanceof MouseEvent}get estimatedHeight(){return 27}}const xt=Ne.StateField.define({create:e=>Ae.Decoration.none,update(e,t){for(let e of t.effects)if(e.is(vt))return e.value;e=e.map(t.changes);for(let i of t.effects)i.is(kt)&&(e=e.update({filter:e=>e!=i.value}));return e},provide:e=>Ae.EditorView.decorations.from(e)});function St(e){const{remote:t,local:i,merged:n,readOnly:s,factory:r,collapseIdentical:o,showBase:l,translator:a}=e;let d={remote:t,local:i,merged:n,config:{readOnly:s},factory:r??$e(),collapseIdentical:o,showBase:l,translator:a},c=new Ot(d),h=[];c.left&&h.push(c.left),c.right&&h.push(c.right),c.merge&&h.push(c.merge);let u=(t||n).mimetype;if(u){for(let e of h)e.remoteEditorWidget.model.mimeType=u;c.base.model.mimeType=u}return c}class Tt{constructor({model:e,type:t,options:i,lockScroll:n,translator:s}){this._model=e,this._trans=(s??d.nullTranslator).load("nbdime"),this._type=t,this._lockScroll=n??!0;let r=this._model.remote||"";this._remoteEditorWidget=new ze({...i,value:r}),this.setScrollLock(this._lockScroll)}init(e){this._baseEditorWidget=e,this._lineChunks=this._model.getLineChunks(),this._chunks=K(this._lineChunks),this.updateView(),this.syncScroll()}updateView(){const e=this._baseEditorWidget.cm,t=this._remoteEditorWidget.cm;this.clearHighlighting(t,this._model.additions,this._chunks,Re.DIFF_INSERT),this.clearHighlighting(e,this._model.deletions,this._chunks,Re.DIFF_DELETE),this.updateHighlighting(t,this._model.additions,this._chunks,Re.DIFF_INSERT),this.updateHighlighting(e,this._model.deletions,this._chunks,Re.DIFF_DELETE)}syncModel(){if(!this.modelInvalid())return;let e=this.remoteEditorWidget.cm,t=this._model.getLineChunks(),i=K(t);if(this._model.remote===e.state.doc.toString())return this._lineChunks=t,void(this._chunks=i);let n=e.state.selection.main.head,s=b(this._model.remote);e.dispatch({changes:{from:0,to:e.state.doc.length,insert:s.slice(0,s.length).join("")}},{selection:{anchor:n}}),this._lineChunks=t,this._chunks=i}buildGap(){let e=this._lockButton=Mt("div",void 0,"cm-merge-scrolllock");e.title=this._trans.__("Toggle locked scrolling"),this.setScrollLock(this._lockScroll),e.addEventListener("click",(e=>{this.setScrollLock(!this._lockScroll)}));let t=Mt("div",[e],"cm-merge-gap");return this._gap=t,this._gap}setScrollLock(e){this._lockScroll=e,this._lockButton&&(this._lockButton.innerHTML=e?"⇛⇚":"⇛&nbsp;&nbsp;⇚"),window.requestAnimationFrame((()=>{this._remoteEditorWidget.cm.scrollDOM.scrollLeft=this._baseEditorWidget.cm.scrollDOM.scrollLeft,this._remoteEditorWidget.cm.scrollDOM.scrollTop=this._baseEditorWidget.cm.scrollDOM.scrollTop}))}modelInvalid(){return this._model instanceof Pe&&this._model.invalid}syncScroll(){if(this.modelInvalid())return;const e=this._baseEditorWidget.cm.scrollDOM,t=this._remoteEditorWidget.cm.scrollDOM;e.addEventListener("scroll",(i=>{this._lockScroll&&window.requestAnimationFrame((function(){t.scrollLeft=e.scrollLeft,t.scrollTop=e.scrollTop}))}),{passive:!0}),t.addEventListener("scroll",(i=>{this._lockScroll&&window.requestAnimationFrame((function(){e.scrollLeft=t.scrollLeft,e.scrollTop=t.scrollTop}))}),{passive:!0})}getDecorationKey(e){let t=this._type,i=t;if("merge"===this._type&&(t=e[0].action,i=t+"Merge",e.length>1))for(let n of e.slice(1))if(n.action!==t){i="mixedMerge";break}return i}getConflictState(e){let t=!1;if(e.length>0)for(let i of e)if(i.decision.conflict){t=!0;break}return t}createGutterEffects(e,t,i,n,s=!1){let r=[],o=ct.of({from:i,on:!0,type:n,block:s});return r.push(o),r.push(bt.of({line:B(e.state.doc,i).line,chunk:t,type:n})),r}buildLineEffects(e,t){let i=[],n=e===this._baseEditorWidget.cm;for(let s of t){let t,r,o=this.getDecorationKey(s.sources),l=this.getConflictState(s.sources);n?(t=s.baseFrom,r=s.baseTo):(t=s.remoteFrom,r=s.remoteTo);for(let n=t;n<r;n++){let a={line:n,column:0},d=V(e.state.doc,a);if(i.push(st.of({from:d,to:d,highlightType:"chunk",decorationKey:o})),l&&i.push(st.of({from:d,to:d,highlightType:"conflict",decorationKey:o})),n===t)if(i.push(st.of({from:d,to:d,highlightType:"start",decorationKey:o})),o.includes("Merge"))if(e===this._baseEditorWidget.cm)for(let t of s.sources)"custom"!==t.decision.action||y(t.decision.localDiff)||y(t.decision.remoteDiff)||(i=i.concat(this.createGutterEffects(e,s,d,"picker")));else l&&e===this.remoteEditorWidget.cm&&(i=i.concat(this.createGutterEffects(e,s,d,"conflict")));else i=i.concat(this.createGutterEffects(e,s,d,"picker"));n===r-1&&i.push(st.of({from:d,to:d,highlightType:"end",decorationKey:o}))}if(t===r){const n=V(e.state.doc,{line:t,column:0});i.push(st.of({from:n,to:n,highlightType:"endEmpty",decorationKey:o})),o.includes("Merge")?l&&(i=i.concat(this.createGutterEffects(e,s,n,"conflict",!0))):i=i.concat(this.createGutterEffects(e,s,n,"picker",!0))}}return i}clearLineEffects(e,t){let i=[];for(let e of t){let t=e.sources,n=this.getDecorationKey(t);for(let e of Ye)i.push(rt.of({highlightType:e,decorationKey:n}))}return e!==this._baseEditorWidget.cm&&(i.push(ht.of({type:"all"})),i.push(_t.of({type:"picker"})),i.push(_t.of({type:"conflict"}))),i}buildCharacterHighlighting(e,t,i){const n=[],s=[];if(i===Re.DIFF_INSERT||i===Re.DIFF_DELETE){const r=i===Re.DIFF_DELETE?"deleted":"inserted";for(let i of t){void 0!==i.source&&s.push(i.source);const t=V(e.state.doc,{line:i.from.line,column:i.from.column}),o=V(e.state.doc,{line:i.to.line,column:i.to.column});n.push(st.of({from:t,to:o,highlightType:r,decorationKey:this.getDecorationKey(s)}))}}return n}clearCharacterHighlighting(e,t,i){let n=[],s=[];if(i===Re.DIFF_INSERT||i===Re.DIFF_DELETE){let e=i===Re.DIFF_DELETE?"deleted":"inserted";for(let i of t){void 0!==i.source&&s.push(i.source);let t=this.getDecorationKey(s);n.push(rt.of({highlightType:e,decorationKey:t}))}}return n}updateHighlighting(e,t,i,n){const s=this.buildLineEffects(e,i),r=this.buildCharacterHighlighting(e,t,n),o=s.concat(r);e.dispatch({effects:o})}clearHighlighting(e,t,i,n){const s=this.clearLineEffects(e,i),r=this.clearCharacterHighlighting(e,t,n),o=s.concat(r);e.dispatch({effects:o})}get remoteEditorWidget(){return this._remoteEditorWidget}get baseEditorWidget(){return this._baseEditorWidget}get chunks(){return this._chunks}get lineChunks(){return this._lineChunks}get model(){return this._model}}function Dt(e,t){let i=0;for(let n=0;n<t.length;n++){let s=t[n];if(s.baseTo>e&&s.baseFrom<=e)return 0;if(s.baseFrom>e)break;i=s.remoteTo-s.baseTo}return e+i}function It(e,t){const i=e.baseFrom;let n=t[t.length-1];for(let e=0;e<t.length;++e){const s=t[e];if(s.baseFrom===i)return s.remoteTo;if(s.baseFrom>i){n=t[e-1];break}}return e.baseTo+(n?n.remoteTo-n.baseTo:0)}class Ot extends f.Panel{constructor(e){super(),this._collapseIdentical=2,this._showBase=!0,this._measuring=-1,this._trans=(e.translator??d.nullTranslator).load("nbdime");let t=e.remote,i=e.local||null,n=e.merged||null,s=this._left=null,r=this._right=null,o=this._merge=null;void 0!==e.collapseIdentical&&(this._collapseIdentical="number"==typeof e.collapseIdentical?Math.max(-1,e.collapseIdentical):e.collapseIdentical?2:-1);let l=0,a=e.remote||e.merged;if(!a)throw new Error("Either remote or merged model needs to be specified!");const c=null!==a.base?a.base:a.remote??"";let h=e.config?.readOnly??!1;e.config={...e.config,lineNumbers:!1!==e.config?.lineNumbers,readOnly:!0},n&&(e.config.lineWrap=e.config.lineWrap??!1),this._aligning=!0;const u=Ae.EditorView.updateListener.of((e=>{this._measuring<0&&e.viewportChanged&&!e.transactions.some((e=>e.effects.some((e=>e.is(lt)))))&&this.alignViews()})),m=[ft,(0,Ae.gutter)({class:"cm-gutter",markers:e=>e.state.field(ft).update({filter:(e,t,i)=>!i.block}),widgetMarker:(e,t,i)=>{if(!(t instanceof dt))return null;const n=e.state.field(ft).update({filter:(e,t,n)=>n.block&&i.from===e});if(n.size>1)throw Error("More than one block gutter widget matched");return 1===n.size?n.iter().value:null},initialSpacer:()=>mt,domEventHandlers:{mouseup:(e,t,i)=>0===i.button&&(this.onGutterClick(e,t),!0)}})],p=!!n,g=p?[u,m,it(p)]:it(p);g.push(Ne.EditorState.phrases.of({"(…$ unchanged lines…)":this._trans.__("(…$ unchanged lines…)")}));const y=!n&&(t?.unchanged||t?.added||t?.deleted);if(this._collapseIdentical>=0&&!y&&g.push(xt),this._base=new ze({...e,extensions:[e.extensions??[],g],value:c}),this.addClass("jp-Mergeview-root"),n){this.addClass("cm-merge-grid-panel");const b=this._showBase=!1!==e.showBase;let _,w;i&&null!==i.remote?(s=this._left=new Tt({model:i,type:"left",options:{...e,config:{...e.config},extensions:[e.extensions??[],g]},lockScroll:b,translator:e.translator}),_=s.remoteEditorWidget):(s=this._left=null,_=new f.Widget({node:Mt("div",this._trans.__("Value missing"),"jp-mod-missing")})),this.addWidget(_),_.addClass("cm-merge-pane"),_.addClass("cm-merge-left-editor"),b&&(this.addWidget(this._base),this._base.addClass("cm-merge-pane"),this._base.addClass("cm-central-editor")),t&&null!==t.remote?(r=this._right=new Tt({model:t,type:"right",options:{...e,config:{...e.config},extensions:[e.extensions??[],g]},lockScroll:b,translator:e.translator}),w=r.remoteEditorWidget):(r=this._right=null,w=new f.Widget({node:Mt("div",this._trans.__("Value missing"),"jp-mod-missing")})),this.addWidget(w),w.addClass("cm-merge-pane"),w.addClass("cm-merge-right-editor"),o=this._merge=new Tt({model:n,type:"merge",options:{...e,config:{...e.config,readOnly:h},extensions:[e.extensions??[],g]},lockScroll:b,translator:e.translator});let C=o.remoteEditorWidget;if(b)this.addWidget(C);else{function k(e,t){e.addEventListener("scroll",(()=>{window.requestAnimationFrame((function(){t.scrollLeft=e.scrollLeft,t.scrollTop=e.scrollTop}))}),{passive:!0}),t.addEventListener("scroll",(()=>{window.requestAnimationFrame((function(){e.scrollLeft=t.scrollLeft,e.scrollTop=t.scrollTop}))}),{passive:!0})}this.insertWidget(1,C),this.left&&k(this.merge.remoteEditorWidget.cm.scrollDOM,this.left.remoteEditorWidget.cm.scrollDOM),this.right&&k(this.merge.remoteEditorWidget.cm.scrollDOM,this.right.remoteEditorWidget.cm.scrollDOM)}C.addClass("cm-merge-pane"),C.addClass("cm-merge-editor"),l=3+(b?1:0)}else if(t)if(t.unchanged||t.added||t.deleted)l=1,this.addWidget(this._base),t.unchanged?this._base.addClass("cm-merge-pane-unchanged"):t.added?this._base.addClass("cm-merge-pane-added"):t.deleted&&this._base.addClass("cm-merge-pane-deleted"),this._base.addClass("cm-merge-pane");else{l=2,this.addWidget(this._base),this._base.addClass("cm-merge-pane"),this._base.addClass("cm-diff-left-editor"),r=this._right=new Tt({model:t,type:"right",options:{...e,config:{...e.config},extensions:[e.extensions??[],g]},translator:e.translator});let v=r.remoteEditorWidget;v.addClass("cm-merge-pane"),v.addClass("cm-diff-right-editor"),this.addWidget(new f.Widget({node:r.buildGap()})),this.addWidget(v)}this.addClass("cm-merge-"+l+"pane");for(let E of[s,r,o])E&&E.init(this._base);this._collapseIdentical>=0&&this.collapseIdenticalStretches(),this._aligning=!1,this._diffViews.length>0&&this.scheduleAlignViews()}alignViews(){const e=this._showBase?this._base.cm.defaultLineHeight:this._diffViews[0].remoteEditorWidget.cm.defaultLineHeight;if(this._aligning)return;this._aligning=!0;const t=function(e){let t=[],i=[],n=e[0],s=e.slice(1);for(let e=0;e<n.lineChunks.length;e++){let r=n.lineChunks[e],o=[r.baseTo,r.remoteTo];for(const e of s)o.push(It(r,e.lineChunks));if(t.length>0&&t[t.length-1][0]===o[0]){let e=t[t.length-1];for(let t=0;t<o.length;++t)e[t]=Math.max(e[t],o[t])}else if(t.length>0){let e=t[t.length-1],n=o[0]-e[0];for(let t=1;t<o.length;++t)if(n!==o[t]-e[t]){n=null;break}if(null!==n){i.push(o[0]);continue}t.push(o)}else t.push(o)}for(let e=0;e<s.length;e++)for(let r=0;r<s[e].lineChunks.length;r++){let o=s[e].lineChunks[r],l=0;for(;l<t.length;l++){let e=t[l];if(g(o.baseTo,i)){l=-1;break}if(e[0]>=o.baseTo)break}if(l>-1){let i=[o.baseTo,It(o,n.lineChunks)];for(let t=0;t<s.length;t++)t===e?i.push(o.remoteTo):i.push(It(o,s[t].lineChunks));if(t.length>l&&t[l][0]===o.baseTo){let e=t[l];for(let t=0;t<i.length;++t)e[t]=Math.max(e[t],i[t])}else t.splice(l,0,i)}}return t}(this._diffViews),i=[this.base.cm,...this._diffViews.map((e=>e.remoteEditorWidget.cm))],n=[];for(let e=0;e<i.length;e++)n.push(new Ne.RangeSetBuilder);const s=new Array(i.length).fill(0),r=i.map((e=>e.state.doc.lines));for(const o of t){const t=this._showBase?o.slice(0,3):o,l=Math.max(...t),a=t.map(((e,t)=>l-e-s[t])),d=this._showBase?Math.min(...a):Math.min(...a.slice(1));a.map((e=>e-d)).forEach(((o,l)=>{if(!this._showBase&&0===l)return;let a=t[l];if(o>0&&a<r[l]){s[l]+=o;const t=V(i[l].state.doc,{line:a,column:0});n[l].add(t,t,Ae.Decoration.widget({widget:new dt(o*e),block:!0,side:-1}))}}))}const o=r.map(((e,t)=>e+s[t])),l=Math.max(...o);o.slice(0,this._showBase?3:4).forEach(((t,r)=>{if(l>t){const o=i[r].state.doc.length,a=l-t;s[r]+=a,n[r].add(o,o,Ae.Decoration.widget({widget:new dt(a*e),block:!0,side:1}))}}));for(let e=0;e<(this._showBase&&i.length>2?i.length-1:i.length);e++){if(0===e&&!this._showBase)continue;const t=n[e].finish();Ne.RangeSet.eq([t],[i[e].state.field(at)])||i[e].dispatch({effects:lt.of(t)})}this._aligning=!1}scheduleAlignViews(){this._measuring<0&&(this._measuring=window.requestAnimationFrame((()=>{this._measuring=-1,this.alignViews()})))}getMergedValue(){if(!this.merge)throw new Error('No merged value; missing "merged" view');return this.merge.remoteEditorWidget.doc.toString()}collapseIdenticalStretches(){const e=this._collapseIdentical;if(e<0)return;const t=this.base.cm,i=new Array(t.state.doc.lines).fill(!0),n=[new Ne.RangeSetBuilder];this.left&&(n.push(new Ne.RangeSetBuilder),Wt(this.left,e,i)),this.right&&(n.push(new Ne.RangeSetBuilder),Wt(this.right,e,i)),this.merge&&(n.push(new Ne.RangeSetBuilder),Wt(this.merge,e,i));for(let s=0;s<i.length;s++)if(i[s]){const r=s+1;let o=1;for(;s<i.length-1&&i[s+1];s++,o++);if(o>e){const e=[{line:r,cm:t}];this.left&&e.push({line:Dt(r,this.left.chunks),cm:this.left.remoteEditorWidget.cm}),this.right&&e.push({line:Dt(r,this.right.chunks),cm:this.right.remoteEditorWidget.cm}),this.merge&&e.push({line:Dt(r,this.merge.chunks),cm:this.merge.remoteEditorWidget.cm}),e.forEach(((t,i)=>{const s=t.cm.state.doc.line(t.line).from,r=t.cm.state.doc.line(t.line+o-1).to;n[i].add(s,r,Ae.Decoration.replace({widget:new Et(o,e),block:!0}))}))}}const s=[t,...this._diffViews.map((e=>e.remoteEditorWidget.cm))];n.forEach(((e,t)=>{const i=e.finish();s[t].dispatch({effects:vt.of(i)})}))}onGutterClick(e,t){let i=[],n=t.from,s=B(e.state.doc,n).line;if(e!=this.merge?.remoteEditorWidget.cm){let n=e.state.field(wt).get(s);if(e!=this._base.cm)for(let e of n.sources)e.decision.action=e.action;else if(this.merge&&e===this._base.cm)for(let e of n.sources)e.decision.action="base";for(let e=n.sources.length-1;e>=0;--e){let t=n.sources[e];this.merge&&y(t.decision.customDiff)&&(t.decision.customDiff=[])}n.sources.length,i.push(ct.of({from:t.from,on:!1,type:"picker",block:!1}))}else{let t=e.state.field(Ct).get(s);for(let i of t.sources)e!==this._base.cm&&(i.decision.conflict=!1)}return e.dispatch({effects:i}),this.updateDiffModels(),this.updateDiffViews(),this.alignViews(),!0}updateDiffModels(){for(let e of this._diffViews)e.model instanceof Pe&&e.model.invalidate(),e.syncModel()}updateDiffViews(){this.clearBaseEditorPickers();for(let e of this._diffViews)e.updateView()}clearBaseEditorPickers(){let e=[];e.push(ht.of({type:"all"})),e.push(_t.of({type:"picker"})),this._base.cm.dispatch({effects:e})}get left(){return this._left}get right(){return this._right}get merge(){return this._merge}get base(){return this._base}get _diffViews(){return[this.left,this.right,this.merge].filter((e=>null!==e))}}function Mt(e,t,i,n){let s=document.createElement(e);if(i&&(s.className=i),n&&(s.style.cssText=n),"string"==typeof t)s.appendChild(document.createTextNode(t));else if(t)for(let e=0;e<t.length;++e)s.appendChild(t[e]);return s}function Wt(e,t,i){for(let n=0;n<e.chunks.length;n++){const s=e.chunks[n];for(let e=s.baseFrom-t;e<s.baseTo+t;e++){const t=e;t>=0&&t<i.length&&(i[t]=!1)}}}var Ft,jt=i(5633);class Lt extends f.PanelLayout{constructor(e={}){super(),this.order=null,this._wrap=!1,this._minimumSpacing=4,this._justifyContent=null,this._alignItems=null,this._alignContent=null,this._dirty=!1,this._direction="top-to-bottom",this._stretchType=null,this._evenSizes=!1,void 0!==e.direction&&(this._direction=e.direction),void 0!==e.minimumSpacing&&(this._minimumSpacing=Ft.clampSpacing(e.minimumSpacing)),void 0!==e.wrap&&(this._wrap=e.wrap),void 0!==e.justifyContent&&(this._justifyContent=e.justifyContent),void 0!==e.alignItems&&(this._alignItems=e.alignItems),void 0!==e.alignContent&&(this._alignContent=e.alignContent),void 0!==e.stretchType&&(this._stretchType=e.stretchType),void 0!==e.evenSizes&&(this._evenSizes=e.evenSizes)}get direction(){return this._direction}set direction(e){this._direction!==e&&(this._direction=e,this.parent&&(Ft.toggleDirection(this.parent,e),this.parent.fit()))}get minimumSpacing(){return this._minimumSpacing}set minimumSpacing(e){e=Ft.clampSpacing(e),this._minimumSpacing!==e&&(this._minimumSpacing=e,this.parent&&(this.parent.node.style.flexWrap=e?"wrap":"nowrap",this.parent.fit()))}get wrap(){return this._wrap}set wrap(e){this._wrap!==e&&(this._wrap=e,this.parent&&(this.parent.node.style.flexWrap=e?"wrap":"nowrap",this.parent.fit()))}get justifyContent(){return this._justifyContent}set justifyContent(e){if(this._justifyContent===e)return;this._justifyContent=e;let t=Ft.translateFlexString(e);this.parent&&(this.parent.node.style.justifyContent=t,this.parent.fit())}get alignItems(){return this._alignItems}set alignItems(e){if(this._alignItems===e)return;this._alignItems=e;let t=Ft.translateFlexString(e);this.parent&&(this.parent.node.style.alignItems=t,this.parent.fit())}get alignContent(){return this._alignContent}set alignContent(e){if(this._alignContent===e)return;this._alignContent=e;let t=Ft.translateFlexString(e);this.parent&&(this.parent.node.style.alignContent=t,!1!==this._wrap&&this.parent.fit())}get stretchType(){return this._stretchType}set stretchType(e){this._stretchType!==e&&(this._stretchType=e,this.parent&&this.parent.fit())}get evenSizes(){return this._evenSizes}set evenSizes(e){this._evenSizes!==e&&(this._evenSizes=e,this.parent&&this.parent.fit())}isHorizontal(){return"right-to-left"===this.direction||"left-to-right"===this.direction}isVertical(){return!this.isHorizontal()}init(){Ft.toggleDirection(this.parent,this.direction),super.init()}attachWidget(e,t){super.attachWidget(e,t),this.order&&c.ArrayExt.insert(this.order,e,t),this.parent.fit()}moveWidget(e,t,i){e!==t&&(this.order||(this.order=this.widgets.slice()),c.ArrayExt.move(this.order,e,t),this._dirty=!0),this.parent.update()}detachWidget(e,t){if(this.order){let e=0;for(;e<this.order.length;++e)if(t===this.order[e]){c.ArrayExt.removeAt(this.order,e);break}}super.detachWidget(e,t),this.parent.fit()}onAfterShow(e){super.onAfterShow(e),this.parent.update()}onAfterAttach(e){super.onAfterAttach(e),Ft.toggleDirection(this.parent,this._direction);let t=this.parent.node.style;t.flexWrap=this._wrap?"wrap":"nowrap",t.justifyContent=Ft.translateFlexString(this._justifyContent)||"",t.alignContent=Ft.translateFlexString(this._alignContent)||"",t.alignItems=Ft.translateFlexString(this._alignItems)||"",this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update()}onUpdateRequest(e){this.parent.isVisible&&this._update()}onFitRequest(e){this.parent.isAttached&&this._fit()}_fit(){this._dirty=!0;let e=this.parent.parent;e&&jt.MessageLoop.sendMessage(e,f.Widget.Msg.FitRequest),this._dirty&&jt.MessageLoop.sendMessage(this.parent,f.Widget.Msg.UpdateRequest)}_update(){this._dirty=!1;let e=this.order||this.widgets;if(0===e.length)return;let t=this.minimumSpacing.toString()+"px";if(this.isHorizontal())for(let i=0;i<e.length-1;++i)e[i].node.style.marginRight=t;else for(let i=0;i<e.length-1;++i)e[i].node.style.marginBottom=t;if(this._evenSizes||this.stretchType){let t=null,i=null,n=null;if(this._evenSizes)t=0,i=1;else switch(this._stretchType){case"grow":i=1,n=0;break;case"shrink":i=0,n=1;break;case"both":i=1,n=1;break;case"fixed":i=0,n=0;break;default:throw new TypeError("Invalid stretch type: "+this._stretchType)}for(let s=0;s<e.length;++s){let r=e[s].node.style;null!==t&&(r.flexBasis=t.toString()),null!==i&&(r.flexGrow=i.toString()),null!==n&&(r.flexShrink=n.toString())}}for(let t=0;t<e.length;++t)e[t].node.style.order=this.order?t.toString():""}}!function(e){e.getGrow=function(e){let t=e.node.style.flexGrow;return t?parseInt(t,10):null},e.setGrow=function(e,t,i=!0){e.node.style.flexGrow=null===t?"":t.toString(),i&&e.parent&&e.parent.fit()},e.getShrink=function(e){let t=e.node.style.flexShrink;return t?parseInt(t,10):null},e.setShrink=function(e,t,i=!0){e.node.style.flexShrink=null===t?"":t.toString(),i&&e.parent&&e.parent.fit()},e.getSizeBasis=function(e){let t=e.node.style.flexBasis;return"auto"===t?"auto":t?parseInt(t.replace("px",""),10):null},e.setSizeBasis=function(e,t,i=!0){e.node.style.flexBasis="auto"===t?t:null===t?"":t.toString()+"px",i&&e.parent&&e.parent.fit()}}(Lt||(Lt={})),function(e){e.isHorizontal=function(e){return"left-to-right"===e||"right-to-left"===e},e.translateFlexString=function(e){return"start"!==e&&"end"!==e||(e="flex-"+e),e},e.toggleDirection=function(e,t){e.toggleClass("lm-mod-left-to-right","left-to-right"===t),e.toggleClass("lm-mod-right-to-left","right-to-left"===t),e.toggleClass("lm-mod-top-to-bottom","top-to-bottom"===t),e.toggleClass("lm-mod-bottom-to-top","bottom-to-top"===t)},e.clampSpacing=function(e){return Math.max(0,Math.floor(e))}}(Ft||(Ft={}));const Nt="lm-FlexPanel-child";class At extends f.Panel{constructor(e={}){super({layout:Pt.createLayout(e)}),e.layout||(void 0!==e.minimumSpacing&&(this.minimumSpacing=e.minimumSpacing),void 0!==e.direction&&(this.direction=e.direction)),this.addClass("lm-FlexPanel")}get direction(){return this.layout.direction}set direction(e){this.layout.direction=e}get minimumSpacing(){return this.layout.minimumSpacing}set minimumSpacing(e){this.layout.minimumSpacing=e}get wrap(){return this.layout.wrap}set wrap(e){this.layout.wrap=e}get justifyContent(){return this.layout.justifyContent}set justifyContent(e){this.layout.justifyContent=e}get alignItems(){return this.layout.alignItems}set alignItems(e){this.layout.alignItems=e}get alignContent(){return this.layout.alignContent}set alignContent(e){this.layout.alignContent=e}get layout(){return super.layout}set layout(e){super.layout=e}get stretchType(){return this.layout.stretchType}set stretchType(e){this.layout.stretchType=e}get evenSizes(){return this.layout.evenSizes}set evenSizes(e){this.layout.evenSizes=e}onChildAdded(e){e.child.addClass(Nt)}onChildRemoved(e){e.child.removeClass(Nt)}onAfterAttach(e){super.onAfterAttach(e),this.fit()}}var Pt;!function(e){e.getGrow=function(e){return Lt.getGrow(e)},e.setGrow=function(e,t){Lt.setGrow(e,t)},e.getShrink=function(e){return Lt.getShrink(e)},e.setShrink=function(e,t){Lt.setShrink(e,t)},e.getSizeBasis=function(e){return Lt.getSizeBasis(e)},e.setSizeBasis=function(e,t){Lt.setSizeBasis(e,t)}}(At||(At={})),function(e){e.createLayout=function(e){return e.layout||new Lt(e)}}(Pt||(Pt={}));const Rt="jp-Diff-twoway",Vt="jp-Diff-added",Bt="jp-Diff-deleted",Ht="jp-Diff-unchanged",Gt=["jp-Diff-base","jp-Diff-remote"],zt="jp-Diff-addremchunk",Ut="jp-Diff-addedchunk",Kt="jp-Diff-removedchunk",qt="jp-Diff-label";class $t extends f.Widget{constructor(e,t,i,n){super(),this.rendermime=i,this.model=e,this.mimetype=n;let s=e.base,r=e.remote;this.layout=new f.PanelLayout;let o=0;if(s){let i=this.createSubView(s,e.trusted);this.layout.addWidget(i),i.addClass(t[o++])}if(r&&r!==s){let i=this.createSubView(r,e.trusted);this.layout.addWidget(i),i.addClass(t[o++])}}get layout(){return super.layout}set layout(e){super.layout=e}}const Jt="jp-Diff-trustCandidate",Zt=["text/html"];let Qt=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/;function Yt(e,t=64){return null!==e&&e.length>t&&Qt.test(e.replace("\n",""))}class Xt extends Ie{constructor({parent:e,editorClasses:t,rendermime:i,...n}){if(super(n),this._mimetype=null,this.forceText=!1,this.rendermime=i,this._trans=this._translator.load("nbdime"),this.editorClasses=t,this._model.trustedChanged.connect(((e,t)=>{this.trustedChanged(t)})),Xt.isTrustSignificant(this._model,this.rendermime)&&this.addClass(Jt),this._model.added){if(!e.added){let e=new f.Widget;e.node.textContent=this._trans.__("Output added"),e.addClass(qt),this.addWidget(e)}this.addClass(Vt)}else if(this._model.deleted){if(!e.deleted){let e=new f.Widget;e.node.textContent=this._trans.__("Output deleted"),e.addClass(qt),this.addWidget(e)}this.addClass(Bt)}else this._model.unchanged?this.addClass(Ht):this.addClass(Rt);let s=this.createView();this.initContainer(s),this.createHoverMenu(),this.addClass("jp-Diff-outputPanel")}initContainer(e){this._model.collapsible?this.container=new Le(e,this._model.collapsibleHeader,this._model.startCollapsed):(this.container=this,this.container.addWidget(e)),this.view=e}replaceView(e){let t=this.view,i=this.container.widgets.indexOf(t);this.container.insertWidget(i,e),t.parent=null,this.view=e}createView(e=!1){let t=null,i=this._model,n=this.rendermime;return t=ei.canRender(i,n)&&!e?new ei(i,this.editorClasses,n,this.selectedMimetype):this.createOutputTextView(),t}createOutputTextView(){let e,t=this._model,i=null;if(null===this.selectedMimetype?(0,c.find)(this.rendermime.mimeTypes,(e=>(i=t.hasMimeType(e),null!==i))):i=t.hasMimeType(this.selectedMimetype),i){let n=t.stringify(i);Yt(n.base||n.remote)||(e=St({remote:n,factory:this._editorFactory,translator:this._translator,...this._viewOptions}))}return e||(e=St({remote:t.stringify(),factory:this._editorFactory,translator:this._translator,...this._viewOptions})),e}createHoverMenu(){this.menu=new f.Panel,this.menu.addClass("jp-Diff-outputMenu"),this.container.addWidget(this.menu);let e=document.createElement("button"),t=[this._trans.__("Show source"),this._trans.__("Render")];e.textContent=t[0],e.onclick=i=>{this.forceText=!this.forceText,e.textContent=t[this.forceText?1:0],this.updateView()};let i=new f.Widget({node:e});i.addClass("jp-Diff-showOutputSourceButton"),this.menu.addWidget(i);let n=document.createElement("button");n.textContent=this._trans.__("Trust"),n.onclick=e=>{this._model.trusted=!this._model.trusted},i=new f.Widget({node:n}),i.addClass("jp-Diff-trustOutputButton"),this.menu.addWidget(i);let s=[];for(let e of this._model.contents){let t=o.OutputModel.getData(e);s=s.concat(Object.keys(t))}if(s=s.filter(x),s.length>1){let e=function(e,t){void 0===t&&(t=document.createElement("select"));for(let i of e){let e=document.createElement("option");e.text=i,t.appendChild(e)}return t}(s),t=this.selectedMimetype;t&&(e.selectedIndex=s.indexOf(t)),e.onchange=t=>{this.selectedMimetype=s[e.selectedIndex]},i=new f.Widget({node:e}),i.addClass("jp-Diff-outputMimetypeSelect"),this.menu.addWidget(i)}else if(1===s.length){let e=document.createElement("span");e.innerText=s[0],i=new f.Widget({node:e}),this.menu.addWidget(i)}}trustedChanged(e){this.updateView(),e?this.removeClass(Jt):Xt.isTrustSignificant(this._model,this.rendermime)&&this.addClass(Jt)}updateView(){let e=this._model;if(this.view instanceof ei)if(!this.forceText&&ei.canRender(e,this.rendermime))this.view.updateView(this.selectedMimetype,e.trusted);else{let e=this.createView(this.forceText);this.replaceView(e)}else{let e=this.createView(this.forceText);this.replaceView(e)}}get selectedMimetype(){if(null!==this._mimetype)return this._mimetype;let e=o.OutputModel.getData(this._model.base||this._model.remote),t=this.rendermime.preferredMimeType(e,this._model.trusted?"any":"ensure");return void 0===t?null:t}set selectedMimetype(e){this._mimetype!==e&&(this._mimetype=e,this.updateView())}static isTrustSignificant(e,t){if(e.trusted)return!1;let i=[];e.base&&i.push(e.base),e.remote&&e.remote!==e.base&&i.push(e.remote);for(let e of i){let i=new o.OutputModel({value:e,trusted:!1}),n=S(Object.keys(i.data),(0,c.toArray)(t.mimeTypes));for(let e of n){let i=t.getFactory(e);if(i&&(!i.safe||-1!==Zt.indexOf(e)))return!0}}return!1}}class ei extends $t{constructor(e,t,i,n){super(e,t,i,n)}createSubView(e,t){let i=new ti(this.rendermime);return i.updateView(e,t,this.mimetype),i}updateView(e,t){let i=0,n=this.model;this.mimetype=e,(0,c.each)(this.layout.widgets,(s=>{if(s instanceof ti){let r=null;0===i&&n.base?r=n.base:n.remote&&(r=n.remote),r&&s.updateView(r,t,e),++i}}))}static canRender(e,t){let i=e.contents;for(let n of i){let i=o.OutputModel.getData(n);if(!t.preferredMimeType(i,e.trusted?"any":"ensure"))return!1}return!0}}class ti extends f.Panel{constructor(e){super(),this.rendermime=e}updateView(e,t,i){let n=this.renderer;this.renderer=this.createRenderer(e,t,i),void 0!==n&&n.dispose(),this.addWidget(this.renderer)}createRenderer(e,t,i){let n=new o.OutputModel({value:e,trusted:t}),s=this.rendermime.createRenderer(i);return s.renderModel(n),s.addClass("jp-Diff-renderedOutput"),Yt(o.OutputModel.getData(e)[i])&&s.addClass("jp-diff-base64Output"),s}}const ii="jp-Cell-diff",ni="jp-Cellrow-outputs";class si extends Ie{constructor({rendermime:e,mimetype:t,...i}){super(i),this.addClass(ii),this._rendermime=e,this._trans=this._translator.load("nbdime"),this.mimetype=t,this.init()}init(){let e=this.model,t=Gt.slice();e.added?(this.addClass(Vt),t=Gt.slice(1,2)):e.deleted?(this.addClass(Bt),t=Gt.slice(0,1)):e.unchanged?this.addClass(Ht):this.addClass(Rt);let i=si.createView({model:e.source,parent:e,editorClasses:t,rendermime:this._rendermime,editorFactory:this._editorFactory,translator:this._translator,...this._viewOptions});if(i.addClass("jp-Cellrow-source"),e.executionCount||e.cellId){const t=e=>{let t=new f.Widget;return t.node.innerText=e,t},n=si.createHeader();At.setGrow(n,1),i.insertWidget(0,n);const s=e.executionCount?si.createPrompts(e.executionCount,e):{base:null,remote:null},r=e.cellId?si.createIdentifiers(e.cellId,e):{base:null,remote:null},o=["base","remote"];for(let i of o){const o=s[i],l=r[i];if(e.executionCount&&null!==o){let e=t(o);e.addClass("jp-InputPrompt"),e.addClass("jp-Cellrow-header-executionCount"),n.addWidget(e)}if(e.cellId&&null!==l){let e=t(`Cell ID: ${l}`);e.addClass("jp-Cellrow-header-cellId"),At.setGrow(e,1),n.addWidget(e)}}}if(this.addWidget(i),!e.metadata.unchanged){let i=si.createView({model:e.metadata,parent:e,editorClasses:t,rendermime:this._rendermime,editorFactory:this._editorFactory,translator:this._translator,...this._viewOptions});i.addClass("jp-Cellrow-metadata"),this.addWidget(i)}const n=e.getChunkedOutputs();if(y(n)){let i=new f.Panel;i.addClass("jp-Diff-outputsContainer");let s=!1;for(let r of n)if(1===r.length){let n=r[0],o=si.createView({model:n,parent:e,editorClasses:t,rendermime:this._rendermime,editorFactory:this._editorFactory,translator:this._translator,...this._viewOptions});i.addWidget(o),s=s||!n.unchanged||n.added||n.deleted}else{let n=new f.Panel;n.addClass(zt);let o=new f.Panel;o.addClass(Ut);let l=new f.Panel;l.addClass(Kt);for(let i of r){let n=i.deleted?l:o,r=si.createView({model:i,parent:e,editorClasses:t,rendermime:this._rendermime,editorFactory:this._editorFactory,translator:this._translator,...this._viewOptions});n.addWidget(r),s=s||!i.unchanged||i.added||i.deleted}n.addWidget(o),n.addWidget(l),i.addWidget(n)}if(e.added||e.deleted)i.addClass(ni),this.addWidget(i);else{let e=!s,t=s?this._trans.__("Outputs changed"):this._trans.__("Outputs unchanged"),n=new Le(i,t,e);n.addClass(ni),this.addWidget(n)}}}static createHeader(){let e=new At({direction:"left-to-right"});return e.addClass("jp-Cellrow-header"),e}static createPrompts(e,t){const i={base:null,remote:null};if(!t.added){let t=e.base;i.base=`In [${t||" "}]:`}if(!t.unchanged&&!t.deleted){let t=e.remote;i.remote=`In [${t||" "}]:`}return i}static createIdentifiers(e,t){return{base:e.base,remote:e.remote}}static createView({model:e,parent:t,editorClasses:i,rendermime:n,editorFactory:s,translator:r,...l}){let a;if(e instanceof ue){let i=null;if(e.unchanged&&"markdown"===t.cellType){let t=new o.MimeModel({data:{"text/markdown":e.base}}),s=n.preferredMimeType(t.data,"ensure");if(!s)throw new Error("No renderer for output");let r=n.createRenderer(s);r.renderModel(t),i=r}else i=St({remote:e,factory:s,translator:r,...l});e.collapsible?a=new Le(i,e.collapsibleHeader,e.startCollapsed):(a=new f.Panel,a.addWidget(i))}else{if(!(e instanceof _e))throw new Error("Unrecognized model type.");a=new Xt({model:e,parent:t,editorClasses:i,rendermime:n,editorFactory:s,translator:r}),e.added?a.addClass(Vt):e.deleted?a.addClass(Bt):e.unchanged?a.addClass(Ht):a.addClass(Rt)}return a}get model(){return this._model}}class ri extends Ie{constructor(e){super(e),console.assert(!this._model.added&&!this._model.deleted),this.addClass("jp-Metadata-diff"),this.init()}init(){let e=this._model;if(!e.unchanged){this.addClass(Rt);let t=St({remote:e,factory:this._editorFactory,translator:this._translator,...this._viewOptions});e.collapsible&&(t=new Le(t,e.collapsibleHeader,e.startCollapsed)),this.addWidget(t)}}}class oi extends Ie{constructor({rendermime:e,...t}){super(t),this._rendermime=e,this.addClass("jp-Notebook-diff")}init(){let e=this._model,t=this._rendermime,i=Promise.resolve();i=i.then((()=>{e.metadata&&this.addWidget(new ri({model:e.metadata,editorFactory:this._editorFactory,translator:this._translator,...this._viewOptions}))}));for(let n of e.chunkedCells)i=i.then((()=>new Promise((i=>{if(1!==n.length||n[0].added||n[0].deleted){let i=new f.Panel;i.addClass(zt);let s=new f.Panel;s.addClass(Ut);let r=new f.Panel;r.addClass(Kt);for(let i of n)(i.deleted?r:s).addWidget(new si({model:i,rendermime:t,mimetype:e.mimetype,editorFactory:this._editorFactory,translator:this._translator,...this._viewOptions}));i.addWidget(s),i.addWidget(r),this.addWidget(i)}else this.addWidget(new si({model:n[0],rendermime:t,mimetype:e.mimetype,editorFactory:this._editorFactory,translator:this._translator,...this._viewOptions}));requestAnimationFrame((()=>{i()}))}))));return i}get model(){return this._model}}var li=i(7048);function ai(e){if(!e.ok){if(500===e.status&&e.body)return e.text().then((e=>{throw new Error(e)}));throw new Error(`${e.status} ${e.statusText}`)}return Promise.resolve(e)}function di(e,t,i){return function(e,t,i){const n=li.URLExt.join("/"===(s=e).slice(-1)?s.slice(0,-1):s,t);var s;let r={method:"POST",body:JSON.stringify(i)},o=u.ServerConnection.makeSettings();return u.ServerConnection.makeRequest(n,r,o).then(ai)}(e,t,i).then((e=>e.json()))}const ci="jp-mod-hideUnchanged";class hi extends f.Panel{constructor(e){super(),this.addClass("nbdime-Widget"),this.base=e.base,this.remote=e.remote,this.editorFactory=e.editorFactory,this.rendermime=e.rendermime,this.translator=e.translator??d.nullTranslator,this.trans=this.translator.load("nbdime");let t=ui.diffHeader(e);this.addWidget(t),this.scroller=new f.Panel,this.scroller.addClass("nbdime-root"),this.scroller.node.tabIndex=-1,this.addWidget(this.scroller);let i,n=t.node.getElementsByClassName("nbdime-hide-unchanged")[0];return n.checked=void 0===e.hideUnchanged||e.hideUnchanged,n.onchange=()=>{ui.toggleShowUnchanged(this.scroller,!n.checked)},e.hideUnchanged&&ui.toggleShowUnchanged(this.scroller,!1),i=this.remote?{base:this.base,remote:this.remote}:"Checkpoint"===e.baseLabel?{base:`checkpoint:${this.base}`}:{base:`git:${this.base}`},s=u.ServerConnection.makeSettings().baseUrl,r="nbdime/api/diff",o=i,l=this.onData.bind(this),a=this.onError.bind(this),di(s,r,o).then(l,(e=>{a(e.message)})),this.id=`nbdime-${JSON.stringify(i)}`,this.title.closable=!0,this;var s,r,o,l,a}dispose(){super.dispose(),this.rendermime=null,this.header=null,this.scroller=null}onActivateRequest(e){this.scroller.node.focus()}onData(e){if(this.isDisposed)return;let t=e.base,i=e.diff,n=new De(t,i);if(n.metadata){const e=this.translator.load("nbdime");n.metadata.collapsibleHeader=e.__("Notebook metadata changed")}let s=new oi({model:n,rendermime:this.rendermime,editorFactory:this.editorFactory,translator:this.translator});this.scroller.addWidget(s);let r=s.init();return r.then((()=>{ui.markUnchangedRanges(this.scroller.node)})),r}onError(e){if(this.isDisposed)return;let t=new f.Widget;t.node.textContent=this.trans.__("Failed to fetch diff: %1",e),this.scroller.addWidget(t)}}var ui;!function(e){function t(e){if(!e.parentElement||!e.parentElement.parentElement)return e;let t=e.parentElement.parentElement;return t.classList.contains(zt)?t:e}function i(e){let i=e.querySelectorAll(`.${ii}`),n=-1;for(let e=0;e<i.length;++e){let s=i[e];if(s.classList.contains(Ht))-1===n&&(n=e);else if(-1!==n){let i=e-n;t(s).setAttribute("data-nbdime-NCellsHiddenBefore",i.toString()),n=-1}}if(-1!==n){let s=i.length-n;if(0===n)return void(e.querySelector(".jp-Notebook-diff")||e).setAttribute("data-nbdime-AllCellsHidden",s.toString());t(i[n-1]).setAttribute("data-nbdime-NCellsHiddenAfter",s.toString())}}e.diffHeader=function(e){let{base:t,remote:i,baseLabel:n,remoteLabel:s,translator:r}=e;const o=(r??d.nullTranslator).load("nbdime");i?(void 0===n&&(n=t),void 0===s&&(s=i)):(n||(n="git HEAD"),s=t);let l=document.createElement("div");return l.className="nbdime-Diff",l.innerHTML='\n      <div class="nbdime-header-buttonrow">\n        <label><input class="nbdime-hide-unchanged" type="checkbox"></label>\n        <button class="nbdime-export" style="display: none"></button>\n      </div>\n      <div class="nbdime-header-banner">\n        <span class="nbdime-header-base"></span>\n        <span class="nbdime-header-remote"></span>\n      </div>',l.querySelector(".nbdime-header-buttonrow > label").insertAdjacentText("beforeend",o.__("Hide unchanged cells")),l.querySelector("button.nbdime-export").textContent=o.__("Export diff"),l.getElementsByClassName("nbdime-header-base")[0].textContent=n,l.getElementsByClassName("nbdime-header-remote")[0].textContent=s,new f.Widget({node:l})},e.toggleShowUnchanged=function(e,t){let n=e.hasClass(ci);if(void 0===t)t=n;else if(n!==t)return;t?e.removeClass(ci):(i(e.node),e.addClass(ci)),e.update()},e.markUnchangedRanges=i}(ui||(ui={}));const fi="nbdime-jupyterlab:plugin";class mi{constructor(e){this.commands=e}createNew(e,t){let i=[],s=-1;(0,c.find)(e.toolbar.children(),((e,t)=>!!e.hasClass("jp-Notebook-toolbarCellType")&&(s=t,!0)));let r=1;for(let t of[pi.diffNotebookCheckpoint,pi.diffNotebookGit]){let o=new n.CommandToolbarButton({commands:this.commands,id:t});o.addClass("nbdime-toolbarButton"),s>=0?e.toolbar.insertItem(s+r++,this.commands.label(t),o):e.toolbar.addItem(this.commands.label(t),o),i.push(o)}return new h.DisposableDelegate((()=>{for(let e of i)e.dispose()}))}}var pi;!function(e){e.diffNotebook="nbdime:diff",e.diffNotebookGit="nbdime:diff-git",e.diffNotebookCheckpoint="nbdime:diff-checkpoint"}(pi||(pi={}));const gi={id:fi,requires:[l.INotebookTracker,o.IRenderMimeRegistry,a.ISettingRegistry,s.IEditorServices],optional:[d.ITranslator],activate:async function(e,t,i,n,s,o){let{commands:l,docRegistry:a}=e,c=new mi(l);a.addWidgetExtension("Notebook",c);const h=await n.load(fi);(function(e,t,i,n,s,o){const{commands:l,shell:a}=e,c=s.factoryService.newInlineEditor.bind(s.factoryService),h=o.load("nbdime"),f=h.__("Unable to query nbdime API. Is the server extension enabled?");let m=!0;function p(){return m&&null!==t.currentWidget}let g={},y=2;function b(e){return()=>m?e:f}let _=!1!==n.get("hideUnchanged").composite;n.changed.connect((()=>{_=!1!==n.get("hideUnchanged").composite})),l.addCommand(pi.diffNotebook,{execute:e=>{},label:b(h.__("Notebook diff")),caption:b(h.__("Display nbdiff between two notebooks")),isEnabled:p,iconClass:"jp-Icon jp-Icon-16 action-notebook-diff action-notebook-diff-notebooks",iconLabel:"nbdiff"}),l.addCommand(pi.diffNotebookCheckpoint,{execute:e=>{let n=t.currentWidget;if(!n)return;let s=function(e){const{path:t,rendermime:i,hideUnchanged:n,editorFactory:s,translator:o}=e,l=(o??d.nullTranslator).load("nbdime");let a=r.PathExt.dirname(t),c=r.PathExt.basename(t,".ipynb"),h=r.PathExt.join(a,c+".ipynb"),u=new hi({base:h,editorFactory:s,rendermime:i,baseLabel:l.__("Checkpoint"),hideUnchanged:n,translator:o});return u.title.label=l.__("Diff checkpoint: %1",c),u.title.caption=l.__("Local: latest checkpoint\nRemote: '%1'",t),u.title.iconClass="fa fa-clock-o jp-fa-tabIcon",u}({path:n.context.path,editorFactory:c,rendermime:i,hideUnchanged:_,translator:o});a.add(s),!1!==e.activate&&a.activateById(s.id)},label:b(h.__("Notebook checkpoint diff")),caption:b(h.__("Display nbdiff from checkpoint to currently saved version")),isEnabled:p,iconClass:"jp-Icon jp-Icon-16 fa fa-clock-o action-notebook-diff action-notebook-diff-checkpoint"}),l.addCommand(pi.diffNotebookGit,{execute:e=>{let n=t.currentWidget;if(!n)return;let s=function(e){const{path:t,rendermime:i,hideUnchanged:n,editorFactory:s,translator:o}=e,l=(o??d.nullTranslator).load("nbdime");let a=r.PathExt.basename(t,".ipynb"),c=new hi({base:t,editorFactory:s,rendermime:i,hideUnchanged:n,translator:o});return c.title.label=l.__("Diff git: %1",a),c.title.caption=l.__("Local: git HEAD\nRemote: '%1'",t),c.title.iconClass="fa fa-git jp-fa-tabIcon",c}({path:n.context.path,editorFactory:c,rendermime:i,hideUnchanged:_,translator:o});a.add(s),!1!==e.activate&&a.activateById(s.id)},label:b(h.__("Notebook Git diff")),caption:b(h.__("Display nbdiff from git HEAD to currently saved version")),isEnabled:function(){if(!p())return!1;let e=t.currentWidget.context.path,i=r.PathExt.dirname(e),n=g[i];if(void 0===n){const e=function(e){let t={method:"POST",body:JSON.stringify(e)},i=u.ServerConnection.makeSettings();return u.ServerConnection.makeRequest(r.URLExt.join((n=i.baseUrl,"/"===n.slice(-1)?n.slice(0,-1):n),"/nbdime/api/isgit"),t,i).then((e=>e.ok?e.json():Promise.reject(e))).then((e=>e.is_git));var n}({path:i});return e.then((e=>{y=2,g[i]=e,e||l.notifyCommandChanged(pi.diffNotebookGit)})),e.catch((e=>{m=void 0!==e.status&&404!==e.status,setTimeout((()=>{y*=2,l.notifyCommandChanged(pi.diffNotebook),l.notifyCommandChanged(pi.diffNotebookCheckpoint),l.notifyCommandChanged(pi.diffNotebookGit)}),y)})),!0}return n},iconClass:"jp-Icon jp-Icon-16 fa fa-git action-notebook-diff action-notebook-diff-git"})})(e,t,i,h,s,o??d.nullTranslator),t.currentChanged.connect((()=>{l.notifyCommandChanged(pi.diffNotebookGit),t.size<=1&&(l.notifyCommandChanged(pi.diffNotebook),l.notifyCommandChanged(pi.diffNotebookCheckpoint))}))},autoStart:!0}}}]);